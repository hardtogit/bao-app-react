webpackJsonp([25],{896:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=(0,m["default"])(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i["default"]?(0,i["default"])(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=a(2),s=r(o),c=a(5),i=r(c),f=a(3),m=r(f),p=a(4),h=r(p),g=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,s["default"])(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),v=a(1),C=r(v),E=a(11),w=r(E),_=a(45),b=r(_),y=a(693),N=r(y),R=a(16),S=r(R),x=a(1702),I=r(x),T=a(1645),A=r(T),L=a(9),k=a(18),D=n(k),B=a(22),M=a(10),O=a(1641),P=r(O),j=void 0,U=function(e){function t(e){u(this,t);var a=d(this,(t.__proto__||(0,h["default"])(t)).call(this,e));return a.componentWillMount=function(){a.props.detail()},a.componentDidUpdate=function(){j=new Image,j.src=A["default"],j.onload=function(){a.state.showCanvas&&a.initCard()}},a.pdCardRes=function(e){if(e){var t=e.data;if(100==e.code){var n=t.name,r=t.amount;a.setState({cardResName:n,cardResAmount:r,fetch:!1}),a.setState({gua:!0})}else a.setState({cardResName:"获取刮刮卡失败",fetch:!1}),a.setState({gua:!0})}},a.initCard=function(){var e=document.body.style;e.mozUserSelect="none",e.webkitUserSelect="none";var t=300,n=152,r=!1,u=document.getElementById("guaCanvas"),d=document.getElementById("box");if(!u)return!1;var l=document.getElementById("card"),o=l.offsetLeft,s=l.offsetTop,c=u.getContext("2d"),i=function(){for(var e=a.state.fetch,r=c.getImageData(0,0,t,n).data,u=0,d=0;u<r.length;u+=4)r[u]&&r[u+1]&&r[u+2]&&r[u+3]&&d++;if(d<=t*n*.6&&!e){var l=a.props.cardInfo.newCards.length;return a.props.useCard(a.props.cardInfo.newCards[a.state.index].id),a.setState({fetch:!0}),a.setState({showCanvas:!1,index:a.state.index+1}),l<=parseInt(a.state.index+1)?a.setState({guaBtn:!0}):c.clearRect(0,0,t,n),!0}return!1},f=void 0,m=function(e){e.preventDefault(),f=d.scrollTop,r=!0},p=function(e){setTimeout(i,800),e.preventDefault(),r=!1},h=function(e){if(e.preventDefault(),r){e.changedTouches&&(e=e.changedTouches[e.changedTouches.length-1]);var t=(e.clientX+document.body.scrollLeft||e.pageX)-o||0,a=(e.clientY+f||e.pageY)-s||0;c.globalCompositeOperation="destination-out",c.beginPath(),c.arc(t,a,15,0,2*Math.PI),c.fill()}};c.drawImage(j,0,0,t,n),u.addEventListener("touchstart",m),u.addEventListener("touchend",p),u.addEventListener("touchmove",h),u.addEventListener("mousedown",m),u.addEventListener("mouseup",p),u.addEventListener("mousemove",h)},a.useNext=function(){a.setState({showCanvas:!0,fetch:!1,cardResName:"",cardResAmount:""})},a.state={showCanvas:!0,index:0,fetch:!1,cardResName:"",cardResAmount:"",guaBtn:!1},a}return l(t,e),g(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.state.fetch,a=e.userCard;t&&this.pdCardRes(a)}},{key:"render",value:function(){var e=this.state,t=e.cardResName,a=e.cardResAmount,n=e.guaBtn,r=e.index,u=(e.over,this.props.cardInfo),d=u.newCards.length;return 0!=r&&(d=u.newCards.length-r),C["default"].createElement("div",{className:N["default"].bg},C["default"].createElement(w["default"],{backgroundColor:"transparent",rightNode:C["default"].createElement(B.Link,{className:N["default"].rightNode,to:"/user/scratchesRule"},"规则"),onLeft:this.props.pop},"我的刮刮卡"),C["default"].createElement(b["default"],{className:N["default"].box,id:"box"},C["default"].createElement("img",{className:N["default"].card_bg_img,src:I["default"],alt:""}),C["default"].createElement("div",{className:N["default"].card_bg},C["default"].createElement("div",{id:"card",className:N["default"].card},u.newCards.length>0&&this.state.showCanvas&&C["default"].createElement("div",{id:"have_card",className:N["default"].have_card},C["default"].createElement("canvas",{id:"guaCanvas",style:{width:283,height:142},className:N["default"].guaBox})),C["default"].createElement("div",{className:N["default"].answer},C["default"].createElement("h2",null,t,a),C["default"].createElement("div",{className:(0,S["default"])(u.newCards.length<=0?N["default"].show:"",N["default"].nullCard)},C["default"].createElement("img",{src:P["default"]}),C["default"].createElement("h2",{className:N["default"].noChoose},"没有刮奖机会"),C["default"].createElement("p",null,"每周五投资即可参与刮奖!")),C["default"].createElement("button",{onClick:this.useNext,className:(0,S["default"])(u.newCards.length>0?N["default"].show:"",N["default"].next),disabled:n},"刮下一张"))),C["default"].createElement("div",{className:N["default"].gg_b},C["default"].createElement("p",{className:N["default"].gg_line}),C["default"].createElement("p",{className:N["default"].gg_info},C["default"].createElement("span",null,"您有",d,"次刮奖机会"),C["default"].createElement(B.Link,{to:"/user/guaguaList"},C["default"].createElement("span",null,"您已获得",u.rewardsTime,"次奖励>")))))))}}]),t}(C["default"].Component),H=function(e){return e&&100===e.code?{newCards:e.data.luck_rewards||[],rewardsTime:e.data.rewards}:{newCards:[],rewardsTime:0}},F=function(e){return{cardInfo:H(e.infodata.getIn([D.SCRATCHES_CARD_INFO,"data"])),userCard:e.infodata.getIn([D.SCRATCHES_CARD_USE,"data"])}},W=function(e){return{detail:function(){e({type:D.SCRATCHES_CARD_INFO})},useCard:function(t){e({type:D.SCRATCHES_CARD_USE,params:[t]})},pop:function(){e((0,M.goBack)())}}};t["default"]=(0,L.connect)(F,W)(U)},971:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(896),u=n(r);t["default"]=u["default"]},1641:function(e,t,a){e.exports=a.p+"static/media/cry.cc155451.png"},1645:function(e,t,a){e.exports=a.p+"static/media/gua.20c170b2.png"},1702:function(e,t,a){e.exports=a.p+"static/media/scratchebg.3f8da319.jpg"}});